% !TEX encoding = KOI8_R
\documentclass[oneside,final,14pt]{extreport}
\usepackage[koi8-r]{inputenc}
\usepackage[russianb]{babel}
\usepackage{amsmath}
\usepackage{vmargin}
\usepackage{graphicx}
\setpapersize{A4}
\setmarginsrb{2.5cm}{1.5cm}{1.5cm}{1.5cm}{0pt}{0mm}{0pt}{13mm}
\linespread{1.5}
%\setcounter{secnumdepth}{-1}
\usepackage{indentfirst}
\sloppy
\begin{document}
\begin{titlepage}
\begin{figure}[t!]
\centering
\includegraphics[width=0.7\linewidth]{msu}
\end{figure}
\begin{centering}
\setcounter{secnumdepth}{0}
\text{Московский государственный университет имени М.В. Ломоносова}

\text{Факультет вычислительной математики и кибернетики}

\text{Кафедра алгоритмических языков}

\vskip1cm
\text{Отчёт о выполнении задания практикума}
\vskip1cm
\text{Модель оптических экспериментов в зеркальной комнате}
\vskip1cm

\Large

\end{centering}
\vskip2cm
\normalsize
\begin{flushright}
\text{Выполнил:}

Студент 424 группы

\emph{Салимов Ярослав Даниилович}


\end{flushright}
\vfill
\centerline{ Москва ~ 2019 г.}
\end{titlepage}
\setcounter{page}{2}
\renewcommand{\contentsname}{Оглавление}
\tableofcontents

% \subsection{Краткая уточнённая постановка задачи}
\subsection{Уточнённая постановка задачи}
Зеркальная комната представляет в плане произвольный замкнутый \hbox{\(M\)-угольник} (\(M \ge 4\)), каждая стена --- плоское зеркало. 
Основная функция программной системы - проведение оптического
эксперимента, при котором из некоторой точки на одной из стен комнаты, под
определенным углом к этой стене (угол может варьироваться от 0 до 180
градусов) выпускается луч света, и затем показывается его путь внутри комнаты
с учетом отражений от зеркал. Траектория луча определяется физическими
законами отражения от зеркальных поверхностей.
Цель моделирования - подбор пользователем системы параметров зеркал
и исходного угла выпущенного луча, при которых луч, отражаясь от зеркальных
стен, попадает в нужную точку (зону) комнаты.
При визуализации оптического эксперимента должен быть показан план
комнаты и изображен путь луча в комнате.
Пользователь системы должен иметь возможность:
\begin{itemize}
    \item определять число \(M\) стен комнаты и рисовать ее план (например, указывая
мышью на экране компьютера угловые точки комнаты);
    \item задавать и изменять положение зеркал, точку выпускания луча и его исходный угол;
    \item запоминать в файле копию оптического эксперимента, сохраняя все его параметры, и считывать сохраненную копию из файла в рабочее окно.
\end{itemize}
Требуется, чтобы указанные действия пользователь мог производить в
произвольном, удобном для него порядке, и изменение одного параметра
эксперимента не должно затрагивать другие установленные параметры.
%\addcontentsline{toc}{subsection}{Введение}

\subsection{Диаграмма классов}
%\addcontentsline{toc}{subsection}{Основная часть}
\includegraphics[width=0.7\linewidth]{cl_d_2}


\subsection{Диаграмма объектов}
В процессе моделирования используются следующие объекты с указанными взаимосвязами между ними:

\includegraphics[width=0.9\linewidth]{obj_diag}

\subsection{Текстовые спецификации интерфейса}
\begin{verbatim}
class Mirror:
    def __init__(self, x1, y1, x2, y2):
        self.x1 = x1
        self.y1 = y1
        self.x2 = x2
        self.y2 = y2

    def draw(self, thickened=False)

    def serialize(self)

    def deserialize(self, data)


class Segment:
    def __init__(self, x1, y1, x2, y2):
        self.x1 = x1
        self.y1 = y1
        self.x2 = x2
        self.y2 = y2

    def draw(self)

    def serialize(self)

    def deserialize(self, data)


class RayLine:
    def __init__(self, x, y, x2, y2, mirrors, line_num, win_circle):
        self.last_mirror = None
        self.segment_list = []
        self.x_0 = x
        self.y_0 = y
        self.vx = x2 - x
        self.vy = y2 - y
        self.count = line_num
        self.mirrors = mirrors
        self.win_circle = win_circle  # кортеж (x0, y0, rad) или None

    def calc_ray_step(self, mirrors)

    def draw(self)

    def serialize(self)

    def deserialize(self, data)


class MyGame(arcade.Window):
    def __init__(self):
        super().__init__(SCREEN_WIDTH, SCREEN_HEIGHT, SCREEN_TITLE)
        self.mirror_list = None
        self.ray = None
        self.prev_coords_y = None
        self.prev_coords_x = None
        self.filename = 'Optical'
        self.win_circle = None

        self.ray_creation_flag = False
        self.mirror_creation_flag = False
        self.click_flag = False
        self.continious_flag = False
        self.win_flag = False
        self.win_click_flag = False
        self.mirror_delete_flag = False

    def get_mirrors(self)

    def setup(self)

    def on_draw(self)

    def on_mouse_press(self, x, y, button, modifiers)

    def on_key_press(self, symbol: int, modifiers: int)

    def serialize(self)

    def deserialize(self, data)

    def save_to_file(self, filename, json_content)

    def load_from_file(self, filename)
\end{verbatim}

\subsection{Инструментальные средства}
В процессе разработки были использованы следующие инструментальные средства:
\begin{itemize}
    \item Язык разработки: Python 3.6
    \item Среда разработки: JetBrains PyCharm
    \item Библиотеки: Arcade
\end{itemize}
\subsection{Файловая структура}
\begin{itemize}
    \item MyGame.py - главный файл
    \item RayLine.py - описание класса RayLine
    \item Mirror.py - описание класса Mirror
    \item Segment.py - описание класса Segment
    \item utils.py - вспомогательные математические функции
    \item requirements.txt - необходимые зависимости
    \item README.md - инструкции по запуску проекта
    \item Optical.json - файл-сохранение. Описывает конфигурацию комнаты
\end{itemize}

\subsection{Пользовательский интерфейс}
Снимок экрана на одном из шагов(в данном случае это последний шаг, тк луч пересёк целевой круг) эксперимента:

\centerline{\includegraphics[width=0.7\linewidth]{ui2}}

Управление параметрами эксперимента осуществляется с клавиатуры. 
Управляющие клавиши:
\begin{itemize}
    \item a - очистить комнату.
    \item m - создать зеркало за 2 клика. Зеркало - отрезок с концами в точках кликов. 
    \item r - запустить луч. Первый клик задаёт точку старта, второй клик - направление луча. 
    \item n - обновить позицию луча: переместить луч к следующему зеркалу. 
    \item w - задать положение целевой окружности. 
    \item d - удалить зеркало или целевую окружность.
    \item s - сохранить текущую конфигурацию комнаты на диск. 
    \item l - загрузить с диска конфигурацию комнаты. 
    \item o - изменить значение флага последовательного создания зеркал. Если этот флаг установлен, будет запоминаться последняя точка создания зеркала и зеркала будут образовывать замкнутую фигуру. 
\end{itemize}
% \addcontentsline{toc}{subsection}{Список литературы} % добавляем пункт "Литература" в оглавление
% \renewcommand{\bibname}{Список литературы}
% \bibliographystyle{unsrt}
% \bibliography{bibl}

\end{document}
